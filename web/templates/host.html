{{define "content"}}
<div class="nes-container with-title">
    <p class="title">Host a Game</p>

    {{if .Errors}}
    <div class="errors">
        {{range .Errors}}
        <p class="nes-text is-error">{{.}}</p>
        {{end}}
    </div>
    {{end}}

    <form method="POST" action="/host">
        <div class="nes-field">
            <label for="game-select">Game</label>
            <div class="nes-select">
                <select name="game-port" id="game-select" required>
                    <option value="" disabled {{if not (.Values.Get "game-port" )}}selected{{end}} hidden>Select a game...</option>
                    {{range .Games}}
                    <option value="{{.Port}}" {{if eq (printf "%d" .Port) ($.Values.Get "game-port" )}}selected{{end}}>{{.Name}} (port {{.Port}})</option>
                    {{end}}
                    <option value="custom" {{if eq ($.Values.Get "game-port" ) "custom" }}selected{{end}}>Custom port...</option>
                </select>
            </div>
            <input type="number" name="custom-game-port" id="custom-port" class="nes-input"
                   min="1" max="65535" placeholder="Enter port number..."
                   value='{{.Values.Get "custom-game-port"}}'
                   style="display:none; margin-top:8px;">
        </div>
        <script>
            (function () {
                var sel = document.getElementById('game-select');
                var inp = document.getElementById('custom-port');
                function toggle() {
                    var custom = sel.value === 'custom';
                    inp.style.display = custom ? '' : 'none';
                    inp.required = custom;
                }
                sel.addEventListener('change', toggle);
                toggle();
            })();
        </script>

        <details class="advanced-options">
            <summary class="nes-btn is-normal">Advanced</summary>
            <div class="advanced-fields">
                <div class="nes-field">
                    <label for="game-key">Game Key</label>
                    <input type="text" name="game-key" id="game-key" class="nes-input"
                           placeholder="XXXX-XXXX (auto-generated if empty)"
                           pattern="[A-Za-z0-9]{4}-[A-Za-z0-9]{4}"
                           title="Format: XXXX-XXXX"
                           value='{{.Values.Get "game-key"}}'>
                </div>
            </div>
        </details>

        <div class="actions">
            <button type="submit" class="nes-btn is-primary">Start Hosting</button>
            <a href="/" class="nes-btn">Back</a>
        </div>
    </form>
</div>
{{end}}
